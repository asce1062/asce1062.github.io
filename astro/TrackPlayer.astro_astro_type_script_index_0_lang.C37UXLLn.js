import{m as i}from"./musicPlayer.BRISxEbm.js";import{m as u}from"./music.CNPadTJM.js";class d{element;audio;trackData=null;albumData=null;trackId;albumId;isGloballyActive=!1;constructor(t){this.element=t,this.audio=t.querySelector(".audio-element"),this.trackId=t.dataset.trackId||"",this.albumId=t.dataset.albumId||"",this.init()}async init(){this.loadTrackData(),this.setupEventListeners(),this.bindMusicPlayerEvents();const t=i.getState();this.updateFromState(t)}loadTrackData(){try{this.albumData=u.albums.find(t=>t.id===this.albumId),this.albumData&&(this.trackData=this.albumData.tracks.find(t=>t.id===this.trackId),this.trackData&&(this.updateTrackInfo(),this.loadAudio()))}catch(t){console.error("Failed to load track data:",t)}}setupEventListeners(){this.element.querySelector(".play-pause-btn")?.addEventListener("click",()=>this.togglePlayPause());const e=this.element.querySelector(".prev-btn"),a=this.element.querySelector(".next-btn");e?.addEventListener("click",()=>i.previousTrack()),a?.addEventListener("click",()=>i.nextTrack()),this.element.querySelector(".loop-btn")?.addEventListener("click",()=>i.toggleLoop()),this.element.querySelector(".progress-container")?.addEventListener("click",r=>this.handleProgressClick(r)),this.element.querySelector(".volume-slider")?.addEventListener("input",r=>this.handleVolumeChange(r)),this.element.querySelector(".download-btn")?.addEventListener("click",()=>this.downloadTrack())}bindMusicPlayerEvents(){i.onTrackStarted(t=>{const{track:e}=t.detail;this.isGloballyActive=e.id===this.trackId,this.updatePlayButton()}),i.onStateChanged(t=>{this.updateFromState(t.detail.state)}),i.onProgressUpdated(t=>{if(this.isGloballyActive){const{currentTime:e,duration:a,percentage:l}=t.detail;this.updateProgress(e,a,l)}}),i.onVolumeChanged(t=>{this.updateVolumeDisplay(Math.round(t.detail.volume*100))}),i.onLoopChanged(t=>{this.isGloballyActive&&this.updateLoopButton(t.detail.isLooping)}),i.onTrackChanged(t=>{const{track:e}=t.detail;this.isGloballyActive=e.id===this.trackId,this.updatePlayButton(),this.isGloballyActive&&(this.element.scrollIntoView({behavior:"smooth",block:"center"}),this.element.classList.add("highlight-track"),setTimeout(()=>{this.element.classList.remove("highlight-track")},3e3))}),i.onShuffleChanged(t=>{console.log(`Track Player: Shuffle ${t.detail.isShuffled?"enabled":"disabled"} for ${this.trackData?.title}`)})}updateFromState(t){const e=t.currentTrack?.id===this.trackId;this.isGloballyActive=e,e?(this.updatePlayButton(t.isPlaying),this.updateLoopButton(t.isLooping),this.updateVolumeSlider(t.volume)):this.updatePlayButton(!1)}updateTrackInfo(){if(!this.trackData)return;const t=this.element.querySelector(".track-title"),e=this.element.querySelector(".track-duration"),a=this.element.querySelector(".track-format");t&&(t.textContent=this.trackData.title),e&&(e.textContent=this.trackData.duration),a&&(a.className=`icon-${this.trackData.format?.toLowerCase()||"mp3"} text-palette-500 dark:text-palette-500 icon-lg track-format flex-shrink-0`)}loadAudio(){this.trackData&&(this.audio.src=this.trackData.file)}updateProgress(t,e,a){const l=this.element.querySelector(".progress-bar");l&&(l.style.width=`${a}%`);const s=this.element.querySelector(".current-time"),o=this.element.querySelector(".total-time");s&&(s.textContent=this.formatTime(t)),o&&(o.textContent=this.formatTime(e))}updatePlayButton(t=!1){const e=this.element.querySelector(".play-icon"),a=this.element.querySelector(".pause-icon");this.isGloballyActive&&t?(e&&(e.style.display="none"),a&&(a.style.display="inline-block")):(e&&(e.style.display="inline-block"),a&&(a.style.display="none"))}updateLoopButton(t){const e=this.element.querySelector(".loop-icon"),a=this.element.querySelector(".loop-one-icon"),l=this.element.querySelector(".loop-btn");t?(e&&(e.style.display="none"),a&&(a.style.display="inline-block"),l&&(l.classList.remove("text-palette-800","dark:text-palette-300"),l.classList.add("text-palette-300","dark:text-palette-400"),l.setAttribute("title","Loop Track (Active)"))):(e&&(e.style.display="inline-block"),a&&(a.style.display="none"),l&&(l.classList.add("text-palette-800","dark:text-palette-300"),l.classList.remove("text-palette-300","dark:text-palette-400"),l.setAttribute("title","Loop Track")))}updateVolumeSlider(t){const e=this.element.querySelector(".volume-slider");e&&(e.value=(t*100).toString(),this.updateVolumeDisplay(Math.round(t*100)))}updateVolumeDisplay(t){const e=this.element.querySelector(".volume-display");e&&(e.textContent=`${t}%`)}togglePlayPause(){const t=i.getState();this.isGloballyActive?t.isPlaying?i.pause():(console.log("Track Player: Resuming current track:",this.trackData?.title),i.play(this.trackId,this.albumId,{forceStart:!0,preservePosition:!0}).catch(e=>{console.error("Failed to resume playback:",e)})):(console.log("Track Player: Starting new track:",this.trackData?.title),i.play(this.trackId,this.albumId))}handleProgressClick(t){if(!this.isGloballyActive)return;const a=t.currentTarget.getBoundingClientRect(),s=(t.clientX-a.left)/a.width,o=i.getState();if(o.duration&&!isNaN(o.duration)){const c=s*o.duration;i.seek(c)}}handleVolumeChange(t){const e=t.target,l=parseInt(e.value)/100;i.setVolume(l)}downloadTrack(){if(!this.trackData)return;const t=document.createElement("a");t.href=this.trackData.file,t.download=`${this.trackData.title}.${this.trackData.format}`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}formatTime(t){if(isNaN(t))return"0:00";const e=Math.floor(t/60),a=Math.floor(t%60);return`${e}:${a.toString().padStart(2,"0")}`}destroy(){}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".track-player").forEach(t=>{new d(t)})});document.addEventListener("astro:page-load",()=>{document.querySelectorAll(".track-player").forEach(t=>{new d(t)})});
