import{m as h}from"./music.CbZ0Re70.js";class d{searchInput;searchResults;searchSuggestions;clearButton;searchTimeout=null;constructor(){this.searchInput=document.getElementById("global-search"),this.searchResults=document.getElementById("search-results"),this.searchSuggestions=document.getElementById("search-suggestions"),this.clearButton=document.getElementById("search-clear"),this.init()}init(){this.searchInput&&this.setupEventListeners()}setupEventListeners(){if(!this.searchInput)return;this.searchInput.addEventListener("input",t=>{const e=t.target.value.trim();this.clearButton&&this.clearButton.classList.toggle("hidden",e.length===0),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{if(e.length===0){this.hideResults();return}if(e.length>=1){const i=this.searchTracks(e);this.displayResults(i,e)}},150)}),this.searchInput.addEventListener("focus",()=>{const t=this.searchInput?.value.trim()||"";if(t.length===0)this.showSuggestions();else if(t.length>=1){const e=this.searchTracks(t);this.displayResults(e,t)}}),this.searchInput.addEventListener("blur",()=>{setTimeout(()=>{this.hideSuggestions()},200)}),this.clearButton&&this.clearButton.addEventListener("click",()=>{this.searchInput&&(this.searchInput.value="",this.clearButton?.classList.add("hidden"),this.hideResults(),this.searchInput.focus())}),document.querySelectorAll(".suggestion-tag").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.query||"";if(this.searchInput){this.searchInput.value=e,this.clearButton&&this.clearButton.classList.remove("hidden"),this.hideSuggestions();const i=this.searchTracks(e);this.displayResults(i,e)}})}),document.addEventListener("click",t=>{const e=t.target;!this.searchInput?.contains(e)&&!this.searchResults?.contains(e)&&!this.searchSuggestions?.contains(e)&&(this.hideResults(),this.hideSuggestions())}),document.addEventListener("keydown",t=>{t.key==="/"&&!["INPUT","TEXTAREA"].includes(t.target.tagName)&&(t.preventDefault(),this.searchInput?.focus()),t.key==="Escape"&&(this.hideResults(),this.hideSuggestions(),this.searchInput?.blur())})}searchTracks(a){const t=[],e=a.toLowerCase();return h.albums.forEach(i=>{(i.title.toLowerCase().includes(e)||i.description.toLowerCase().includes(e)||i.genre.some(s=>s.toLowerCase().includes(e)))&&t.push({type:"album",relevance:this.calculateRelevance(e,i.title,i.description),...i}),i.tracks.forEach(s=>{(s.title.toLowerCase().includes(e)||s.description.toLowerCase().includes(e)||s.format.toLowerCase().includes(e)||s.genre.some(n=>n.toLowerCase().includes(e)))&&t.push({type:"track",album:i.title,albumId:i.id,relevance:this.calculateRelevance(e,s.title,s.description),...s})})}),t.sort((i,r)=>r.relevance-i.relevance).slice(0,8)}calculateRelevance(a,t,e){let i=0;const r=t.toLowerCase(),s=e.toLowerCase();return r===a?i+=100:r.startsWith(a)?i+=50:r.includes(a)&&(i+=25),s.includes(a)&&(i+=10),i+=Math.max(0,20-t.length),i}displayResults(a,t){if(this.searchResults){if(a.length===0)this.searchResults.innerHTML=`
          <div class="p-lg-responsive text-palette-900 dark:text-gray-400 text-center">
            <div class="mb-sm-responsive text-sm-responsive font-proto">No results found for "${this.escapeHtml(t)}"</div>
            <div class="text-xs-responsive text-palette-900/50 dark:text-gray-500 font-proto">Try searching for track names, albums, or genres</div>
          </div>
        `;else{const e={albums:a.filter(s=>s.type==="album"),tracks:a.filter(s=>s.type==="track")};let i="";e.albums.length>0&&(i+='<div class="p-sm-responsive text-xs-responsive text-palette-900/50 dark:text-gray-500 bg-light-200 dark:bg-palette-800/50 font-proto">Albums</div>',i+=e.albums.map(s=>`
            <a href="/album/${s.id}" class="block p-md-responsive hover:bg-light-200 dark:hover:bg-palette-800 border-b border-palette-800/30 dark:border-palette-300/30 transition-colors">
              <div class="flex items-center gap-md-responsive">
                <div class="min-w-0 flex-1">
                  <div class="text-palette-900 dark:text-white font-medium truncate text-sm-responsive font-proto">${this.highlightMatch(this.escapeHtml(s.title),t)}</div>
                  <div class="text-palette-900 dark:text-gray-400 text-xs-responsive font-proto">Album • ${s.tracks?s.tracks.length:0} tracks</div>
                </div>
              </div>
            </a>
          `).join("")),e.tracks.length>0&&(e.albums.length>0&&(i+='<div class="p-sm-responsive text-xs-responsive text-palette-900/50 dark:text-gray-500 bg-light-200 dark:bg-palette-800/50 border-t border-palette-800/30 dark:border-palette-300/30 font-proto">Tracks</div>'),i+=e.tracks.map(s=>`
            <a href="#" class="search-track-link block p-md-responsive hover:bg-light-200 dark:hover:bg-palette-800 border-b border-palette-800/30 dark:border-palette-300/30 last:border-b-0 transition-colors" 
               data-track-id="${s.id}" 
               data-album-id="${s.albumId}"
               data-track-title="${this.escapeHtml(s.title)}"
               data-album-title="${this.escapeHtml(s.album)}">
              <div class="flex items-center gap-md-responsive">
                <div class="min-w-0 flex-1">
                  <div class="text-palette-900 dark:text-white font-medium truncate text-sm-responsive font-proto">${this.highlightMatch(this.escapeHtml(s.title),t)}</div>
                  <div class="text-palette-900 dark:text-gray-400 text-xs-responsive truncate font-proto">${this.escapeHtml(s.album)} • ${this.escapeHtml(s.duration)} • ${this.escapeHtml(s.format.toUpperCase())}</div>
                </div>
              </div>
            </a>
          `).join("")),this.searchResults.innerHTML=i,this.searchResults.querySelectorAll(".search-track-link").forEach(s=>{s.addEventListener("click",l=>{l.preventDefault();const n=s.dataset.trackId,o=s.dataset.albumId;n&&o&&this.navigateToTrack(n,o)})})}this.searchResults.classList.remove("hidden"),this.hideSuggestions()}}navigateToTrack(a,t){this.clearSearch();const e=window.location.pathname,i=`/album/${t}`;e===i?this.scrollToTrack(a):window.location.href=`${i}#track-${a}`}scrollToTrack(a){const t=document.getElementById(`track-${a}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlight-track"),setTimeout(()=>{t.classList.remove("highlight-track")},3e3),history.pushState(null,"",`#track-${a}`))}showSuggestions(){this.searchSuggestions&&this.searchSuggestions.classList.remove("hidden"),this.searchResults&&this.searchResults.classList.add("hidden")}hideSuggestions(){this.searchSuggestions&&this.searchSuggestions.classList.add("hidden")}hideResults(){this.searchResults&&this.searchResults.classList.add("hidden")}clearSearch(){this.searchInput&&(this.searchInput.value=""),this.clearButton&&this.clearButton.classList.add("hidden"),this.hideResults(),this.hideSuggestions()}highlightMatch(a,t){if(!t)return a;const e=new RegExp(`(${this.escapeRegex(t)})`,"gi");return a.replace(e,'<mark class="bg-palette-300/30 text-palette-800 dark:bg-palette-300/30 dark:text-palette-300">$1</mark>')}escapeRegex(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}escapeHtml(a){const t=document.createElement("div");return t.textContent=a,t.innerHTML}}function c(){new d}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c();document.addEventListener("astro:page-load",c);
