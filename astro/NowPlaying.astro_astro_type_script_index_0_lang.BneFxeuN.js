import{m as o}from"./musicPlayer.BRISxEbm.js";import"./music.CNPadTJM.js";class m{collapsedElement;expandedElement;expandedContainer;isVisible=!1;isExpanded=!1;footerObserver=null;constructor(){this.collapsedElement=document.getElementById("now-playing-collapsed"),this.expandedElement=document.getElementById("now-playing-expanded"),this.expandedContainer=document.getElementById("now-playing-card"),!(!this.collapsedElement||!this.expandedElement)&&this.init()}init(){this.setupEventListeners(),this.setupFooterOverlapPrevention(),this.bindMusicPlayerEvents();const e=o.getState();this.updateFromState(e)}setupEventListeners(){const e=document.getElementById("expand-now-playing"),t=document.getElementById("collapse-now-playing");e?.addEventListener("click",i=>{i.stopPropagation(),this.expand()}),t?.addEventListener("click",()=>this.collapse()),document.getElementById("collapsed-play-pause")?.addEventListener("click",i=>{i.stopPropagation(),this.togglePlayPause()}),this.collapsedElement?.addEventListener("click",()=>this.expand()),this.expandedElement?.addEventListener("click",i=>{i.target===this.expandedElement&&this.collapse()});const s=document.getElementById("expanded-play-pause"),l=document.getElementById("expanded-prev"),a=document.getElementById("expanded-next"),d=document.getElementById("expanded-loop");s?.addEventListener("click",()=>this.togglePlayPause()),l?.addEventListener("click",()=>o.previousTrack()),a?.addEventListener("click",()=>o.nextTrack()),d?.addEventListener("click",()=>o.toggleLoop());const r=this.collapsedElement?.querySelector(".mini-progress-container-collapsed"),c=this.expandedElement?.querySelector(".expanded-progress-container");r?.addEventListener("click",i=>{i.stopPropagation(),this.handleProgressClick(i)}),c?.addEventListener("click",i=>this.handleProgressClick(i)),this.expandedElement?.querySelector(".expanded-volume-slider")?.addEventListener("input",i=>{const h=parseInt(i.target.value)/100;o.setVolume(h)}),document.addEventListener("keydown",i=>{if(!["INPUT","TEXTAREA"].includes(i.target.tagName))switch(i.key){case" ":i.preventDefault(),this.togglePlayPause();break;case"ArrowLeft":i.preventDefault(),o.previousTrack();break;case"ArrowRight":i.preventDefault(),o.nextTrack();break;case"l":case"L":i.preventDefault(),o.toggleLoop();break;case"Escape":this.isExpanded&&(i.preventDefault(),this.collapse());break}})}bindMusicPlayerEvents(){o.onTrackStarted(e=>{const{track:t,album:n}=e.detail;this.updateTrackInfo(t,n),this.show()}),o.onStateChanged(e=>{this.updateFromState(e.detail.state)}),o.onProgressUpdated(e=>{const{currentTime:t,duration:n,percentage:s}=e.detail;this.updateProgress(t,n,s)}),o.onVolumeChanged(e=>{this.updateVolumeDisplay(Math.round(e.detail.volume*100))}),o.onLoopChanged(e=>{this.updateLoopButton(e.detail.isLooping)}),o.onTrackChanged(e=>{const{track:t,album:n}=e.detail;this.updateTrackInfo(t,n)})}setupFooterOverlapPrevention(){this.footerObserver=new IntersectionObserver(n=>{n.forEach(s=>{this.updateWidgetPosition()})},{root:null,rootMargin:"0px",threshold:.1});const e=document.querySelector("footer");e&&this.footerObserver&&this.footerObserver.observe(e);let t=null;window.addEventListener("scroll",()=>{t&&clearTimeout(t),t=window.setTimeout(()=>{this.updateWidgetPosition()},10)}),window.addEventListener("resize",()=>{this.updateWidgetPosition()})}updateWidgetPosition(){if(!this.collapsedElement||!this.isVisible||this.isExpanded)return;const e=document.querySelector("footer");if(!e)return;const t=e.getBoundingClientRect(),n=window.innerHeight,s=16;let l=s;t.top<n&&(l=n-t.top+s+10),this.collapsedElement.style.bottom=`${l}px`,this.collapsedElement.style.transition="bottom 0.3s ease, opacity 0.3s ease, scale 0.2s cubic-bezier(0.4, 0, 0.2, 1)"}updateFromState(e){e.currentTrack&&e.currentAlbum?(this.updateTrackInfo(e.currentTrack,e.currentAlbum),this.updatePlayButton(e.isPlaying),this.updateLoopButton(e.isLooping),this.updateVolumeSlider(e.volume),e.isVisible&&this.show()):this.isVisible&&this.hide()}updateTrackInfo(e,t){const n=this.collapsedElement?.querySelector(".now-playing-title-collapsed"),s=this.collapsedElement?.querySelector(".now-playing-album-collapsed");n&&(n.textContent=e.title||"Unknown Track",this.setupMarquee(n)),s&&(s.textContent=t.title||"Unknown Album");const l=this.expandedElement?.querySelector(".now-playing-title-expanded"),a=this.expandedElement?.querySelector(".now-playing-album-expanded"),d=this.expandedElement?.querySelector(".now-playing-album-art"),r=this.expandedElement?.querySelector(".now-playing-release-date");if(l&&(l.textContent=e.title||"Unknown Track",this.setupMarquee(l)),a&&(a.textContent=t.title||"Unknown Album"),d&&t&&(d.src=t.coverArt||"/art/default-cover.png",d.alt=`${t.title} album cover`),r&&t){const c=new Date(t.releaseDate).toLocaleDateString();r.textContent=`Released ${c}`}}setupMarquee(e){e.classList.remove("scrolling"),setTimeout(()=>{const t=e.parentElement;if(!t)return;const n=e.scrollWidth,s=t.clientWidth;n>s?(e.style.paddingRight="20px",e.classList.add("scrolling")):(e.style.paddingRight="0px",e.classList.remove("scrolling"))},100)}updateProgress(e,t,n){const s=this.collapsedElement?.querySelector(".mini-progress-bar-collapsed");s&&(s.style.width=`${n}%`);const l=this.expandedElement?.querySelector(".expanded-progress-bar"),a=this.expandedElement?.querySelector(".expanded-current-time"),d=this.expandedElement?.querySelector(".expanded-total-time");l&&(l.style.width=`${n}%`),a&&(a.textContent=this.formatTime(e)),d&&(d.textContent=this.formatTime(t))}updatePlayButton(e){const t=this.expandedElement?.querySelector(".expanded-play-icon"),n=this.expandedElement?.querySelector(".expanded-pause-icon"),s=this.collapsedElement?.querySelector(".collapsed-play-icon"),l=this.collapsedElement?.querySelector(".collapsed-pause-icon");e?(t&&(t.style.display="none"),n&&(n.style.display="inline-block"),s&&(s.style.display="none"),l&&(l.style.display="inline-block")):(t&&(t.style.display="inline-block"),n&&(n.style.display="none"),s&&(s.style.display="inline-block"),l&&(l.style.display="none"))}updateLoopButton(e){const t=this.expandedElement?.querySelector(".expanded-loop-icon"),n=this.expandedElement?.querySelector(".expanded-loop-one-icon"),s=this.expandedElement?.querySelector("#expanded-loop");e?(t&&(t.style.display="none"),n&&(n.style.display="inline-block"),s&&(s.classList.remove("text-palette-800","dark:text-palette-300"),s.classList.add("text-palette-800","dark:text-palette-400"),s.setAttribute("title","Loop Track (Active)"))):(t&&(t.style.display="inline-block"),n&&(n.style.display="none"),s&&(s.classList.add("text-palette-800","dark:text-palette-300"),s.classList.remove("text-palette-800","dark:text-palette-400"),s.setAttribute("title","Loop Track")))}updateVolumeSlider(e){const t=this.expandedElement?.querySelector(".expanded-volume-slider");t&&(t.value=(e*100).toString(),this.updateVolumeDisplay(Math.round(e*100)))}updateVolumeDisplay(e){const t=this.expandedElement?.querySelector(".expanded-volume-display");t&&(t.textContent=`${e}%`)}togglePlayPause(){const e=o.getState();e.isPlaying?o.pause():e.currentTrack&&e.currentAlbum&&(console.log("Now Playing: Resuming current track:",e.currentTrack.title),o.play(e.currentTrack.id,e.currentAlbum.id,{forceStart:!0,preservePosition:!0}).catch(t=>{console.error("Failed to resume playback:",t)}))}handleProgressClick(e){const n=e.currentTarget.getBoundingClientRect(),l=(e.clientX-n.left)/n.width,a=o.getState();if(a.duration&&!isNaN(a.duration)){const d=l*a.duration;o.seek(d)}}show(){this.isVisible||(this.isVisible=!0,this.collapsedElement.style.opacity="1",this.collapsedElement.style.pointerEvents="auto",this.updateWidgetPosition())}hide(){this.isVisible&&(this.isVisible=!1,this.collapsedElement.style.opacity="0",this.collapsedElement.style.pointerEvents="none")}expand(){this.isExpanded||(this.isExpanded=!0,this.collapsedElement.style.opacity="0",this.collapsedElement.style.pointerEvents="none",this.expandedElement?.classList.remove("hidden"),setTimeout(()=>{this.expandedContainer?.classList.remove("translate-y-full"),this.expandedContainer?.classList.add("translate-y-0")},10))}collapse(){this.isExpanded&&(this.isExpanded=!1,this.expandedContainer?.classList.add("translate-y-full"),this.expandedContainer?.classList.remove("translate-y-0"),setTimeout(()=>{this.expandedElement?.classList.add("hidden"),this.isVisible&&(this.collapsedElement.style.opacity="1",this.collapsedElement.style.pointerEvents="auto",this.updateWidgetPosition())},300))}formatTime(e){if(isNaN(e))return"0:00";const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${n.toString().padStart(2,"0")}`}destroy(){this.footerObserver&&this.footerObserver.disconnect()}}let p=null;function u(){p&&p.destroy(),p=new m}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u();document.addEventListener("astro:page-load",u);
